<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Elasticsearch - Anand vyas</title>
    <meta content="Elasticsearch - Anand vyas" property="og:title">
    <meta content="elk, elasticsearch, elastic search" name="keywords">
    <meta content="elk" property="og:description">
    <meta name="author" content="Anand Vyas">

    
    <link href="https://anandvyas.in/css/bootstrap.min.css" rel="stylesheet">
    
    <link href="https://anandvyas.in/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    <link href="https://anandvyas.in/css/highlighter.css" rel="stylesheet">
    
    <link href="https://anandvyas.in/css/sb-admin.css" rel="stylesheet">
    <link href="https://anandvyas.in/css/about.css" rel="stylesheet">

    <script src="https://anandvyas.in/js/jquery.min.js"></script>
</head>
<body class="fixed-nav sticky-footer bg-dark sidenav-toggled" id="page-top">
  
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
    <a class="navbar-brand" href="https://anandvyas.in/">
        <img src="https://anandvyas.in/images/profile/logo.png" />
        <span>Anand vyas</span>
    </a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive"
        aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav navbar-sidenav">
            <li class="nav-item sidebar-profile text-center">
                <div class="profile-pic">
                    <img src="https://anandvyas.in/images/profile/avatar.jpg" alt="avatar">
                </div>
                <div class="profile-detail">
                    
                    <span>Solution Architect</span> 
                    <span>Cloud Architect</span> 
                    <span>DevOps</span> 
                    <span>Tech Lead</span> 
                </div>
            </li>
            
            <li class="nav-item sidebar-menu" data-toggle="tooltip" data-placement="right" title="Home">
                <a class="nav-link" href="https://anandvyas.in/">
                <i class="fa fa-fw fa fa-home"></i>
                <span class="nav-link-text">Home</span>
                </a>
            </li>
            
            <li class="nav-item sidebar-menu" data-toggle="tooltip" data-placement="right" title="About">
                <a class="nav-link" href="https://anandvyas.in/about">
                <i class="fa fa-fw fa fa-user-circle"></i>
                <span class="nav-link-text">About</span>
                </a>
            </li>
            
            <li class="nav-item sidebar-menu" data-toggle="tooltip" data-placement="right" title="Categories">
                <a class="nav-link" href="https://anandvyas.in/categories">
                <i class="fa fa-fw fa fa-dashboard"></i>
                <span class="nav-link-text">Categories</span>
                </a>
            </li>
            
            <li class="nav-item sidebar-menu" data-toggle="tooltip" data-placement="right" title="Tags">
                <a class="nav-link" href="https://anandvyas.in/tags">
                <i class="fa fa-fw fa fa-tags"></i>
                <span class="nav-link-text">Tags</span>
                </a>
            </li>
            
        </ul>
        <ul class="navbar-nav sidenav-social">
            
            <li><a href="#" target="_blank"><i class="fa fa-mobile"></i></a></li>
            
            <li><a href="mailto:anandvyas@live.com" target="_blank"><i class="fa fa-envelope"></i></a></li>
            
            <li><a href="https://twitter.com/anandvyaas" target="_blank"><i class="fa fa-twitter"></i></a></li>
            
            <li><a href="https://www.linkedin.com/in/anandvyaas" target="_blank"><i class="fa fa-linkedin"></i></a></li>
            
            <li><a href="https://www.instagram.com/anandvyaas" target="_blank"><i class="fa fa-instagram"></i></a></li>
            
            <li><a href="https://github.com/anandvyas" target="_blank"><i class="fa fa-github"></i></a></li>
            
            <li><a href="https://stackoverflow.com/users/8208060/anand-vyas" target="_blank"><i class="fa fa-stack-overflow"></i></a></li>
            
        </ul>
        <ul class="navbar-nav sidenav-toggler">
            <li class="nav-item">
                <a class="nav-link text-center" id="sidenavToggler">
            <i class="fa fa-fw fa-angle-left"></i>
            </a>
            </li>
        </ul>
        
        
    </div>
</nav>
  
  <div class="content-wrapper">
    <div class="container-fluid">
    


<ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="https://anandvyas.in/">Home</a></li>


    
    <li class="breadcrumb-item active"><a href='https://anandvyas.in/elk'>elk</a></li>
    
    


    
    <li class="breadcrumb-item active"><a href='https://anandvyas.in/elk/elasticsearch'>elasticsearch</a></li>
    
    


    

</ol>

        <div class="post">
            <h1>Elasticsearch</h1>
            <span class="post-date">Sat, Apr 21, 2018</span>
            

<p>Elasticsearch is an open-source, RESTful, distributed search and analytics engine built on Apache Lucene.</p>

<h3 id="a-class-innerlink-name-elasticsearch-installation-installation-elasticsearch-a"><a class="innerlink" name="elasticsearch-installation">Installation Elasticsearch</a></h3>

<pre><code class="language-sh"># update your package index
sudo apt-get update

# Download latest version
# Check version information: https://www.elastic.co/downloads/past-releases
wget https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/deb/elasticsearch/2.3.1/elasticsearch-2.3.1.deb

# Install through dpkg command
sudo dpkg -i elasticsearch-2.3.1.deb

</code></pre>

<h3 id="installation-elasticsearch-from-repository">Installation Elasticsearch from Repository</h3>

<pre><code class="language-sh">
# update your system
sudo apt-get update

# install Java
sudo apt-get install default-jre

# add Elastic’s signing key
wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -

#  install the apt-transport-https package
sudo apt-get install apt-transport-https

# add the repository definition to your system
echo &quot;deb https://artifacts.elastic.co/packages/6.x/apt stable main&quot; | sudo tee -a /etc/apt/sources.list.d/elastic-6.x.list

# update your repositories and install Elasticsearch
sudo apt-get update
sudo apt-get install elasticsearch
sudo service elasticsearch start
sudo systemctl enable elasticsearch.service
</code></pre>

<ul>
<li>Elasticsearch install in <strong>/usr/share/elasticsearch/</strong></li>
<li>Elasticsearch configruation file <strong>/etc/elasticsearch</strong></li>
<li>Elasticsearch init script added in <strong>/etc/init.d/elasticsearch</strong></li>
</ul>

<h3 id="elasticsearch-config-file-location">Elasticsearch Config File Location</h3>

<p>The default Elasticsearch configruation directory default location is <strong>\$ES_HOME/config</strong> (<strong>/etc/elasticsearch</strong>). In the configruation directory there are three config files</p>

<ul>
<li><strong>elasticsearch.yml</strong>: for configuring Elasticsearch</li>
<li><strong>jvm.options</strong>: for configuring Elasticsearch JVM settings</li>
<li><strong>log4j2.properties</strong> for configuring Elasticsearch logging</li>
</ul>

<h3 id="configuring-elasticsearch-cluster">Configuring Elasticsearch Cluster</h3>

<p>Elasticsearch cluster is a group of one or more Elasticsearch nodes instances that are connected together and each node has its own roles and responsibilities.</p>

<div class="text-center">
    <img class="img-responsive" src="https://anandvyas.in/images/elk/elk.png" alt="Elasticsearch" />
</div>
 

<ul>
<li><strong>Data nodes</strong>: stores data and executes data-related operations such as search and aggregation</li>
<li><strong>Master nodes</strong>: in charge of cluster-wide management and configuration actions such as adding and removing nodes</li>
<li><strong>Client nodes</strong>: forwards cluster requests to the master node and data-related requests to data nodes</li>
<li><strong>Ingest nodes</strong>: for pre-processing documents before indexing</li>
</ul>

<h4 id="configuring-for-other-nodes">Configuring for Other Nodes</h4>

<p>Let&rsquo;s undenstand the Elasticsearch configruation for different type of nodes with example. Let&rsquo;s assume we need four instance (1 master node, 1 client node, 2 data nodes) within one cluster.</p>

<div class="text-center">
    <img class="img-responsive" src="https://anandvyas.in/images/elk/example.png" alt="Elasticsearch" />
</div>
 

<div class="row">
<div class="col-lg-6">
        <div class="card">
  <div class="card-header">
    Master Node Configruation
  </div>
  <div class="card-body">
    <div>cluster.name: Anandvyas</div>
    <div>node.name: "es-node-1"</div>
    <div>node.master: true</div>
    <div>node.data: true</div>
    <div>network.host: 172.11.61.21</div>
    <div>http.port: 9200</div>
    <div>discovery.zen.ping.unicast.hosts: ["172.11.61.21", "172.11.61.22","172.11.61.23","172.11.61.24"]</div>
  </div>
</div>
</div>
<div class="col-lg-6">
        <div class="card">
  <div class="card-header">
    Client Node Configruation
  </div>
  <div class="card-body">
    <div>cluster.name: Anandvyas</div>
<div>node.name: "es-node-2"</div>
<div>node.master: false</div>
<div>node.data: false</div>
<div>network.host: 172.11.61.22</div>
<div>http.port: 9200</div>
<div>discovery.zen.ping.unicast.hosts: ["172.11.61.21", "172.11.61.22",
"172.11.61.23","172.11.61.24"]</div>
  </div>
</div>
</div>
</div>
</br>
<div class="row">
<div class="col-lg-6">
        <div class="card">
  <div class="card-header">
    Data Node - 1 Configruation
  </div>
  <div class="card-body">
    <div>cluster.name: Anandvyas</div>
<div>node.name: "es-node-3"</div>
<div>node.master: false</div>
<div>node.data: true</div>
<div>network.host: 172.11.61.23</div>
<div>http.port: 9200</div>
<div>discovery.zen.ping.unicast.hosts: ["172.11.61.21", "172.11.61.22",
"172.11.61.23","172.11.61.24"]</div>
    

<p></div>
</div>
</div>
<div class="col-lg-6">
        <div class="card">
  <div class="card-header">
    Data Node - 2 Configruation
  </div>
  <div class="card-body">
    <div>cluster.name: Anandvyas</div>
<div>node.name: &ldquo;es-node-4&rdquo;</div>
<div>node.master: false</div>
<div>node.data: true</div>
<div>network.host: 172.11.61.24</div>
<div>http.port: 9200</div>
<div>discovery.zen.ping.unicast.hosts: [&ldquo;172.11.61.21&rdquo;, &ldquo;172.11.61.22&rdquo;,
&ldquo;172.11.61.23&rdquo;,&ldquo;172.11.61.24&rdquo;]</div>
  </div>
</div>
</div>
</div></p>

<p>After configruation you have to restart your elasticsearch <strong>sudo service elasticsearch start</strong></p>

<h3 id="checking-cluster-status">Checking Cluster Status</h3>

<p>Some of the below URL&rsquo;s through that you will check the Clustur/Node health and status</p>

<pre><code># Cluster Health
curl -XGET 'localhost:9200/_cluster/health?pretty'

# Cluster State
curl -XGET 'localhost:9200/_cluster/state?pretty'

# Cluster Stats
curl -XGET 'localhost:9200/_cluster/stats?human&amp;pretty'

# Nodes Stats
curl -XGET 'localhost:9200/_nodes/stats?pretty'

# Nodes Index-only stats
curl -XGET 'localhost:9200/_nodes/stats/indices?pretty'
</code></pre>

<h3 id="elasticsearch-cluster-configurations-for-production">Elasticsearch Cluster Configurations for Production</h3>

<p>We already defined the different roles for the nodes in our cluster, but there are some additional recommended settings for a cluster running in a production environment.</p>

<h4 id="avoiding-split-brain">Avoiding &ldquo;Split Brain&rdquo;</h4>

<p>A &ldquo;split-brain&rdquo; situation is when communication between nodes in the cluster fails due to either a network failure or an internal failure with one of the nodes. In this kind of scenario, more than one node might believe it is the master node, leading to a state of data inconsistency. For avoiding this situation make below entry in configruation file.</p>

<pre><code>discovery.zen.minimum_master_nodes: 2
</code></pre>

<p>A best practice to determine this number is to use the following formula to decide this number: <strong>N/2 + 1</strong>. N is the number of master eligible nodes in the cluster</p>

<h4 id="adjusting-jvm-heap-size">Adjusting JVM heap size</h4>

<p>The maximum heap size should be set up to 50% of your RAM, but no more than 32GB. These value can be configured using the Xmx and Xms settings in the <strong>/etc/elasticsearch/jvm.options</strong> file.</p>

<pre><code>-Xms2g
-Xmx2g
</code></pre>

<h4 id="disabling-swapping">Disabling swapping</h4>

<h4 id="adjusting-virtual-memory">Adjusting virtual memory</h4>

<h4 id="increasing-open-file-descriptor-limit">Increasing open file descriptor limit</h4>

        </div>
        
    </div>
    
    
    <footer class="sticky-footer">
    <div class="container">
        <div class="text-center">
            <small>Copyright © Anand Vyas 2019</small>
        </div>
    </div>
</footer>

<a class="scroll-to-top rounded" href="#page-top">
    <i class="fa fa-angle-up"></i>
</a>


<script src="https://anandvyas.in/js/popper.min.js"></script>
<script src="https://anandvyas.in/js/bootstrap.min.js"></script>
<script src="https://anandvyas.in/js/highlight.min.js"></script>
<script src="https://anandvyas.in/js/moment.min.js"></script>
<script src="https://anandvyas.in/js/clipboard.min.js"></script>

<script src="https://anandvyas.in/js/jquery.easing.min.js"></script>

<script src="https://anandvyas.in/js/sb-admin.js"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-108803266-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-108803266-1');
</script>
  </div>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>
